"use strict";(self.webpackChunkephemeris_notes=self.webpackChunkephemeris_notes||[]).push([[8919],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var o=a.createContext({}),c=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(o.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),h=i,d=u["".concat(o,".").concat(h)]||u[h]||m[h]||r;return n?a.createElement(d,l(l({ref:t},p),{},{components:n})):a.createElement(d,l({ref:t},p))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:i,l[1]=s;for(var c=2;c<r;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4819:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>m});var a=n(7462),i=n(7294),r=n(3905);class l extends i.Component{constructor(e){super(e),this.state=this.calcState(816356e6,1),this.handleChange=this.handleChange.bind(this)}calcState(e,t){let n=BigInt(e)/BigInt(t);return{value:Number(n),distance:e,distanceStr:this.calcDistance(e),scale:t,precision32:this.calcDistance(this.calcPrecision32(n)*t),precision64:this.calcDistance(this.calcPrecision64(n)*t)}}calcDistance(e){if(e=Number(e),isNaN(e))return"Out Of Range";const t=["y","z","a","f","p","n","u","m","","k","M","G","T","P","E","Z","Y"],n=e.toExponential(2).split(/e/);let a=Math.floor(+n[1]/3)+8;return a>t.length-1?a=t.length-1:a<0&&(a=0),(n[0]*Math.pow(10,+n[1]-3*(a-8))).toFixed(6)+t[a]+"m"}calcPrecision32(e){var t=Number(e),n=new Float32Array(1);return n[0]=t,new Int32Array(n.buffer)[0]++,n[0]-t}calcPrecision64(e){var t=Number(e),n=new Float64Array(1);return n[0]=t,new BigInt64Array(n.buffer)[0]++,n[0]-t}handleChange(e){let t=this.state.distance,n=this.state.scale;switch(e.target.name){case"distance":t=e.target.value;break;case"scale":n=e.target.value}this.setState(this.calcState(t,n))}render(){return i.createElement("form",null,i.createElement("p",null,"Given a distance (the actual ",i.createElement("bold",null,"distance")," you want to store) and a scale (sets what the number '1.0' actually represents) calculate the smallest possible distance that can be represented at that distance."),i.createElement("p",null,i.createElement("label",{for:"distance"},"Distance: "),i.createElement("input",{type:"number",name:"distance",id:"distance",step:"any",value:this.state.distance,onChange:this.handleChange})),i.createElement("p",null,i.createElement("label",{for:"scale"},"Scale: "),i.createElement("input",{type:"scale",name:"scale",id:"scale",step:"any",value:this.state.scale,onChange:this.handleChange})),i.createElement("ul",null,i.createElement("li",null,"Distance: ",this.state.distanceStr),i.createElement("li",null,"Stored Value: ",this.state.value),i.createElement("li",null,"Single Precision: ",this.state.precision32),i.createElement("li",null,"Double Precision: ",this.state.precision64)))}}n(2389);const s={title:"Precision & Scale"},o=void 0,c={unversionedId:"ImplementationDetails/PrecisionScale/PrecisionScale",id:"ImplementationDetails/PrecisionScale/PrecisionScale",title:"Precision & Scale",description:"Ephemeris needs to represent the entire solar system, at these extreme scales the precision of floating point numbers can become a serious issues. For example if the aphelion of Jupiter (5.4570 AU) is stored as metres (816,356,000,000) then the smallest possible step a single precision float (i.e. C# float, Rust f32) can represent is 65.5 kilometres!",source:"@site/docs/ImplementationDetails/PrecisionScale/PrecisionScale.md",sourceDirName:"ImplementationDetails/PrecisionScale",slug:"/ImplementationDetails/PrecisionScale/",permalink:"/EphemerisNotes/ImplementationDetails/PrecisionScale/",draft:!1,editUrl:"https://github.com/martindevans/EphemerisNotes/tree/master/docs/ImplementationDetails/PrecisionScale/PrecisionScale.md",tags:[],version:"current",frontMatter:{title:"Precision & Scale"},sidebar:"tutorialSidebar",previous:{title:"Planning",permalink:"/EphemerisNotes/ImplementationDetails/Planning"},next:{title:"CarmackStarRendering",permalink:"/EphemerisNotes/ImplementationDetails/Rendering/CarmackStarRendering"}},p={},m=[{value:"Scaling",id:"scaling",level:2},{value:"Calculator",id:"calculator",level:2},{value:"Relevance To Ephemeris",id:"relevance-to-ephemeris",level:2},{value:"References",id:"references",level:2}],u={toc:m};function h(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Ephemeris needs to represent the entire solar system, at these extreme scales the precision of floating point numbers can become a serious issues. For example if the aphelion of Jupiter (5.4570 AU) is stored as metres (816,356,000,000) then the smallest possible step a single precision float (i.e. C# ",(0,r.kt)("inlineCode",{parentName:"p"},"float"),", Rust ",(0,r.kt)("inlineCode",{parentName:"p"},"f32"),") can represent is 65.5 ",(0,r.kt)("strong",{parentName:"p"},"kilometres"),"!"),(0,r.kt)("p",null,"This is a problem even on ",(0,r.kt)("em",{parentName:"p"},"much")," smaller scales smaller scales. For example Unity, which uses single precision floats, recommends a max map size of 50km [",(0,r.kt)("a",{parentName:"p",href:"https://forum.unity.com/threads/large-world-coordinates-double-precision-data.1371378/#post-8645223"},"2"),"]. At this scale the smallest possible step size is 1.95mm."),(0,r.kt)("h2",{id:"scaling"},"Scaling"),(0,r.kt)("p",null,"It is tempting to think that scaling the units in use, for example representing all positions as kilometres instead of metres, will gain back more precision. ",(0,r.kt)("strong",{parentName:"p"},"This is wrong"),"."),(0,r.kt)("p",null,'Scaling the value down by some factor (e.g. 1000) does improves the smallest possible step size, but that step is now measured in larger units and thus has to be scaled up by the same factor. These two operations effectively cancel each other out. You can see this effect in the calculator below; the "scale" setting reduces the scale of the value but increases the scale of the step size.'),(0,r.kt)("h2",{id:"calculator"},"Calculator"),(0,r.kt)(l,{mdxType:"FloatCalculator"}),(0,r.kt)("p",null,"This calculation is done by reinterpreting (i.e. converting it without changing the bit pattern at all) the floating point value as an integer [",(0,r.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/7538734/reinterpret-cast-floating-point-number-to-integer"},"3"),'], incrementing the integer and reinterpreting it back to a float. This gets the next value along the "number line" which is the smallest possible change in value that can be represented.'),(0,r.kt)("h2",{id:"relevance-to-ephemeris"},"Relevance To Ephemeris"),(0,r.kt)("p",null,"Example step size at various planets:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Jupiter (",(0,r.kt)("inlineCode",{parentName:"li"},"5.5AU"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"816_100_000_000m"),"): 0.12mm"),(0,r.kt)("li",{parentName:"ul"},"Saturn (",(0,r.kt)("inlineCode",{parentName:"li"},"10AU"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"1_503_980_000_000m"),"): 0.24mm"),(0,r.kt)("li",{parentName:"ul"},"Uranus (",(0,r.kt)("inlineCode",{parentName:"li"},"20AU"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"3_006_389_400_000m"),"): 0.48mm"),(0,r.kt)("li",{parentName:"ul"},"Neptune (",(0,r.kt)("inlineCode",{parentName:"li"},"30.3AU"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"4_537_300_000_000m"),"): 7.18mm")),(0,r.kt)("p",null,"Ephemeris is a realistic game based on plausible, near-future technology. It is extremely unlikely this level of tech will be able to reach the farthest reaches of the solar system in any kind of vehicle that can engage in combat! The game will not set any missions beyond Uranus, to avoid exceeding the 1mm minimum step size. This yields a smaller step size than the 1.95mm step size which Unity themselves recommend [",(0,r.kt)("a",{parentName:"p",href:"https://forum.unity.com/threads/large-world-coordinates-double-precision-data.1371378/#post-8645223"},"2"),"]."),(0,r.kt)("h2",{id:"references"},"References"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://blog.demofox.org/2017/11/21/floating-point-precision/"},"Demystifying Floating Point\xa0Precision")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://forum.unity.com/threads/large-world-coordinates-double-precision-data.1371378/#post-8645223"},"Unity forum, map scale")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/7538734/reinterpret-cast-floating-point-number-to-integer"},"StackOverflow JS reinterpret float"))))}h.isMDXComponent=!0}}]);